<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-form/iron-form.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<link rel="import" href="../iron-form/iron-form.html">
<link rel="import" href="../paper-input/paper-input.html">
<link rel="import" href="../paper-button/paper-button.html">
<link rel="import" href="../paper-dialog/paper-dialog.html">

<!--
`crud-list`
List of elements with CRUD operatoins

@demo demo/index.html
-->

<dom-module id="crud-list">
    <template>
        <style>
            :host {
                display: block;
                color: #3c3c3c;
                font-family: Helvetica, Arial, sans-serif;
            }

            .items-table {
                width: 100%;
                border-collapse: collapse;
            }

            .header {
                background-color: #808080;
            }

            .header-item{
            }

            .header-item, .item-field {
                text-align: center;
                padding: 8px;
            }

            .item:nth-child(even) {
                background-color: #dddddd;
            }

            .item:nth-child(even):hover, .item:nth-child(odd):hover {
                background-color: #808080;
                color: white;
            }

            .item-field {
            }

            .new-item-link:hover{
                color: #cb4b16;
            }

            .form-container{
                max-height: 0;
                opacity: 0;
                transition: opacity 0.4s, max-height 0.4s linear;
            }

            .form-container-visible{
                opacity: 1;
                max-height: 500px;
            }

        </style>

        <paper-dialog id="delete_item_dialog">
            <h2>Are you sure?</h2>
            <p>Do you really want to remove this [[itemType]] from the list?</p>
            <div class="buttons">
                <paper-button dialog-dismiss>Decline</paper-button>
                <paper-button dialog-confirm autofocus>Accept</paper-button>
            </div>
        </paper-dialog>


        <table class="items-table">
            <tr class="header">
                <template is="dom-repeat" id="item-headers" items="{{headers}}">
                    <th class="header-item">[[item]]</th>
                </template>
                <th class="header-item"></th>
            </tr>
            <template is="dom-repeat" id="item-list" items="{{items}}">
                <tr class="item">
                    <td class="item-field">[[item.name]]</td>
                    <td class="item-field">[[item.frequency]]</td>
                    <td class="item-field">[[item.location]]</td>
                    <td class="item-field">[[item.thrusts]]</td>
                    <td class="item-field">
                        <paper-icon-button src="http://icons.iconarchive.com/icons/designcontest/outline/32/Pencil-icon.png" alt="edit" title="edit"></paper-icon-button>
                        <paper-icon-button src="http://icons.iconarchive.com/icons/custom-icon-design/mini/32/Close-icon.png" alt="remove" title="remove" on-click="_openModal"></paper-icon-button>
                    </td>
                </tr>
            </template>
        </table>

        <div id="new_item_button">
            <paper-icon-button hidden$="[[formVisible]]" src="http://icons.iconarchive.com/icons/custom-icon-design/mini/32/Add-icon.png" alt="show_form" title="form"></paper-icon-button>
            <paper-button hidden$="[[formVisible]]" class="new-item-link">New [[itemType]]</paper-button>
            <paper-icon-button hidden$="[[!formVisible]]" src="http://icons.iconarchive.com/icons/icons8/windows-8/32/Science-Minus2-Math-icon.png" alt="remove" title="remove"></paper-icon-button>
            <paper-button hidden$="[[!formVisible]]" class="new-item-link">Hide</paper-button>
        </div>

        <div id="form_container" class="form-container">
            <form is="iron-form" method="get" action="/" id="new_item_form">
                <template is="dom-repeat" id="form-item-inputs" items="{{headers}}">
                    <paper-input name="[[item]]" label="[[item]]" required></paper-input>
                </template>
                <paper-button raised id="form_submit" >Submit</paper-button>
                <paper-button raised ID="form_reset">Reset</paper-button>
                <div class="output"></div>
            </form>
        </div>

    </template>
    <script>
        Polymer({

            is: 'crud-list',

            properties: {

                headers: {
                    type: Array,
                    value: function () {
                        return [
                            'name',
                            'frequency',
                            'location',
                            'thrusts'
                        ]
                    }
                },

                items: {
                    type: Array,
                    value: function () {
                        return [
                            {
                                name: 'Daily meeting',
                                frequency: 'Every day',
                                location: 'office',
                                thrusts: 1
                            },
                            {
                                name: 'Sprint planning',
                                frequency: 'Every two weeks',
                                location: 'office',
                                thrusts: 1
                            },
                            {
                                name: 'Sprint retro',
                                frequency: 'Every two weeks',
                                location: 'office',
                                thrusts: 1
                            },
                            {
                                name: 'Sprint review',
                                frequency: 'Every two weeks',
                                location: 'office',
                                thrusts: 1
                            }
                        ]
                    }
                },

                newItem: {
                    type: Object,
                    value: function () {
                        return {}
                    }
                },

                itemToDelete: {
                    type: Object,
                    value: function () {
                        return {}
                    }
                },

                itemType: {
                    type: String,
                    value: function () {
                        return 'Bull'
                    }
                },

                formVisible: {
                    type: Boolean,
                    value: function(){
                        return false;
                    },
                    observer: '_toggleFormClass'
                }
            },

            listeners: {
                'form_submit.click': '_submit',
                'form_reset.click': '_reset',
                'new_item_button.click': '_toggleForm',
                'iron-overlay-closed': '_deleteItem'
            },

            ready: function() {
                var _this = this;
                this.$.new_item_form.addEventListener('iron-form-submit', function(event) {
                    _this._addItemToList(event.detail);
                });
            },

            /**
             * Function to submit new item form
             * @param event
             * @private
             */
            _submit: function(event) {
                event.currentTarget.parentElement.submit();
            },

            /**
             * Function to reset new item form
             * @param event
             * @private
             */
            _reset: function (event) {
                var form = event.currentTarget.parentElement;
                form.reset();
            },

            /**
             * Function to add item to the list
             * @param item
             * @private
             */
            _addItemToList: function(item){
                this.push('items',item);
            },

            /**
             * Function to edit item from list
             * @param event
             * @private
             */
            _editItem: function(item){
                this.push('items',item);
            },


            /**
             * Function to delete item from list
             * @param event
             * @private
             */
            _deleteItem: function(event){
                if(event.detail.confirmed){
                    var index = this._findItemIndex(this.itemToDelete);
                    this.splice('items', index, 1);
                }
            },
            /**
             * Function to find index of item in array
             * @param item
             * @private
             */
            _findItemIndex: function(item){
                return this.items.findIndex(function(i){
                    return i === item;
                });
            },

            /**
             * Function to update formVisible property to show or
             * hide new item formdisplay or hide new item form
             * @private
             */
            _toggleForm: function(){
                this.set('formVisible', !this.formVisible);
            },

            /**
             * Function to toggle new item form class to
             * @private
             */
            _toggleFormClass: function(){
                this.toggleClass('form-container-visible', this.formVisible, this.$.form_container);
            },

            /**
             * Function to display modal dialog
             * @param event
             * @private
             */
            _openModal: function(event){
                this.$.delete_item_dialog.open();
                this.set('itemToDelete', event.model.__data__.item);
            }



        });
    </script>
</dom-module>
